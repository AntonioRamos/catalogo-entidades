
<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rede Ageas â€“ Listagem</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <div class="nav">
      <img class="logo" src="https://www.ageas.pt/media/4874/logotipo-da-ageas-seguros.png" alt="Ageas Seguros" />
      <div class="spacer"></div>
      <a class="btn secondary" href="mapa.html">Ver Mapa</a>
    </div>
  </header>

  <section class="hero">
    <div class="container inner">
      <div>
        <h1>Rede Ageas 2025</h1>
        <p>Procure e filtre a listagem de entidades. Agora com novo layout com destaque ao mapa e cores institucionais.</p>
        <div class="cta">
          <a class="primary" href="mapa.html">Abrir mapa</a>
          <a class="ghost" href="#lista">Ir para listagem</a>
        </div>
      </div>
      <div>
        <div style="aspect-ratio:16/10; border-radius:16px; border:2px solid var(--accent-strong); background:linear-gradient(135deg, var(--accent), #fff); display:grid; place-items:center; color:#fff; font-weight:800; font-size:clamp(18px,2.2vw,24px);">Mapa Interativo</div>
      </div>
    </div>
  </section>

  <main class="container" id="lista">
    <div class="searchbar">
      <input id="q" type="search" placeholder="Pesquisar por nome, entidade, localidade ou distritoâ€¦" />
      <select id="filtro-distrito"><option value="">Todos os distritos</option></select>
      <select id="filtro-tip"><option value="">Todas as tipificaÃ§Ãµes</option></select>
    </div>

    <div id="stats" style="margin-top:10px; color:var(--muted);"></div>
    <div class="list" id="cards"></div>
  </main>

  <footer class="footer">&copy; Ageas Seguros. Dados atualizados automaticamente do Excel.</footer>

  <script>
  const $ = sel => document.querySelector(sel);
  const $$ = sel => Array.from(document.querySelectorAll(sel));
  let DATA = [];

  function badgeCaps(caps) {
    const items = [];
    for (const [k,v] of Object.entries(caps)) { if (v) items.push(k); }
    return items.map(t => `<span class="badge">${t}</span>`).join('');
  }

  function render() {
    const q = $('#q').value.trim().toLowerCase();
    const fd = $('#filtro-distrito').value;
    const ft = $('#filtro-tip').value;
    let rows = DATA.filter(r => {
      const txt = (r.nome + ' ' + r.entidade + ' ' + r.localidade + ' ' + r.distrito + ' ' + r.tipificacao).toLowerCase();
      return (!q || txt.includes(q)) && (!fd || r.distrito === fd) && (!ft || r.tipificacao === ft);
    });
    $('#stats').textContent = `${rows.length} de ${DATA.length} resultados`;
    $('#cards').innerHTML = rows.map(r => `
      <article class="card">
        <div class="name">${r.nome || r.estabelecimento || r.entidade}</div>
        <div>${r.morada} ${r.codigo_postal ? ' â€¢ ' + r.codigo_postal : ''} </div>
        <div>${r.localidade} ${r.distrito ? ' â€¢ ' + r.distrito : ''}</div>
        <div style="color:var(--muted);">${r.tipificacao}</div>
        <div class="badges">${badgeCaps(r.capabilities)}</div>
        <div style="margin-top:8px; display:flex; gap:10px; flex-wrap:wrap;">
          ${r.telefone ? `<a href="tel:${r.telefone}" class="badge">ğŸ“ ${r.telefone}</a>` : ''}
          ${r.email ? `<a href="mailto:${r.email}" class="badge">âœ‰ï¸ ${r.email}</a>` : ''}
          ${(r.lat && r.lon) ? `<a class="badge" target="_blank" href="https://maps.google.com/?q=${r.lat},${r.lon}">ğŸ—ºï¸ Ver no mapa</a>` : ''}
        </div>
      </article>
    `).join('');
  }

  fetch('entidades.json').then(r => r.json()).then(rows => {
    DATA = rows;
    const distritos = [...new Set(rows.map(r => r.distrito).filter(Boolean))].sort();
    const tips = [...new Set(rows.map(r => r.tipificacao).filter(Boolean))].sort();
    $('#filtro-distrito').innerHTML += distritos.map(d => `<option value="${d}">${d}</option>`).join('');
    $('#filtro-tip').innerHTML += tips.map(t => `<option value="${t}">${t}</option>`).join('');
    render();
  });

  $$('#q, #filtro-distrito, #filtro-tip').forEach(el => el.addEventListener('input', render));
  </script>
</body>
</html>
